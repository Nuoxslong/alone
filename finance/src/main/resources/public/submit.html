<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<link href="/css/bootstrap.min.css" rel="stylesheet">
<body>
<div class="container">
    <form method="post" onsubmit="return false">
        <div class="mb-3">
            <label for="user"></label>
            <input type="text" class="form-control" name="user" disabled id="user" value="user">
        </div>
        <div class="mb-3">
            <div class="dropdown" id="typeDropdown">
                <button id="dropdown-type-button" class="btn btn-secondary dropdown-toggle" type="button"
                        data-bs-toggle="dropdown" aria-expanded="false">
                    <span id="type-span">支出</span>
                </button>
                <input type="hidden" id="type" value="EXPEND"/>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#">支出</a></li>
                    <li><a class="dropdown-item" href="#">收入</a></li>
                </ul>
            </div>
        </div>
        <div class="mb-3">
            <label for="amount"></label>
            <input type="text" class="form-control" name="amount" id="amount">
        </div>
        <div class="mb-3">
            <label for="remark"></label>
            <input type="text" class="form-control" name="remark" id="remark">
        </div>
        <div class="mb-3">
            <button type="button" onclick="flow()" class="btn btn-primary">记账</button>
        </div>

    </form>
</div>


</body>

<script src="/js/jquery-3.7.1.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script>

    function TypeDropDown(ele) {
        this.dropdown = ele;
        this.typeSpan = this.dropdown.find("#type-span");
        this.options = this.dropdown.find("ul.dropdown-menu > li");
        this.val = '';
        this.index = -1;//默认为-1;
        this.initEvents();
    }

    TypeDropDown.prototype = {
        initEvents: function () {
            const obj = this;
            //点击下拉列表的选项
            obj.options.on("click", function () {
                const opt = $(this);
                obj.text = opt.find("a").text();
                obj.val = opt.attr("value");
                obj.index = opt.index();
                obj.typeSpan.text(obj.text);
                if (obj.text === "支出") {
                    $("#type").val("EXPEND");
                } else {
                    $("#type").val("INCOME");
                }
            });
        }
    }

    $(document).ready(function () {
        new TypeDropDown($("#typeDropdown"));
    });

    function flow() {
        let type = document.getElementById("type").value;
        let amount = document.getElementById("amount").value;
        let remark = document.getElementById("remark").value;
        $.ajax({
            type: "post",
            dataType: "json",
            url: "/flow",
            contentType: "application/json",
            data: JSON.stringify({
                "user": "user",
                "type": type,
                "amount": amount,
                "remark": remark
            }),
            success: function (result) {
                console.log("result is :" + result)
                location.reload();
            }
        })
    }

</script>
</html>