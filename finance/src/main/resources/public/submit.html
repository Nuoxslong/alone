<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<link href="/css/bootstrap.min.css" rel="stylesheet">
<body>
<div class="container">

    <div class="input-group mb-3">
        <span class="input-group-text" id="basic-addon1">lastTime</span>
        <input disabled id="lastTime" type="text" class="form-control" aria-label="Username"
               aria-describedby="basic-addon1">
        <span class="input-group-text" id="basic-addon2">amount</span>
        <input disabled id="lastAmount" type="text" class="form-control" aria-label="Username"
               aria-describedby="basic-addon1">
        <span class="input-group-text" id="basic-addon3">remark</span>
        <input disabled id="lastRemark" type="text" class="form-control" aria-label="Username"
               aria-describedby="basic-addon1">
    </div>

    <form method="post" onsubmit="return false">
        <div class="mb-3">
            <label for="user"></label>
            <input type="text" class="form-control" name="user" disabled id="user" value="user">
        </div>
        <div class="mb-3">
            <div class="dropdown" id="typeDropdown">
                <button id="dropdown-type-button" class="btn btn-secondary dropdown-toggle" type="button"
                        data-bs-toggle="dropdown" aria-expanded="false">
                    <span id="type-span">支出</span>
                </button>
                <input type="hidden" id="type" value="EXPEND"/>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#">支出</a></li>
                    <li><a class="dropdown-item" href="#">收入</a></li>
                </ul>
            </div>
        </div>
        <div class="mb-3">
            <label for="amount"></label>
            <input type="text" class="form-control" name="amount" id="amount">
        </div>
        <div class="mb-3">
            <label for="remark"></label>
            <input type="text" class="form-control" name="remark" id="remark">
        </div>
<!--        <div class="container ">-->
<!--            <label for="time"></label>-->
<!--            <input type="text" id="time" class="form-control" placeholder="请选择日期">-->
<!--        </div>-->
        <div class="mb-3">
            <button type="button" onclick="flow()" class="btn btn-primary">记账</button>
        </div>

    </form>

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">-.-</strong>
                <small></small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastContent"></div>
        </div>
    </div>
</div>


</body>

<script src="/js/jquery-3.7.1.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>
<script>

    function TypeDropDown(ele) {
        this.dropdown = ele;
        this.typeSpan = this.dropdown.find("#type-span");
        this.options = this.dropdown.find("ul.dropdown-menu > li");
        this.val = '';
        this.index = -1;//默认为-1;
        this.initEvents();

    }
    // $("#time").datepicker({
    //     language: 'zh-CN', //语言
    //     autoclose: true, //选择后自动关闭
    //     clearBtn: true,//清除按钮
    //     format: "yyyy-MM-dd hh:mm:ss"//日期格式
    // });

    TypeDropDown.prototype = {
        initEvents: function () {
            const obj = this;
            //点击下拉列表的选项
            obj.options.on("click", function () {
                const opt = $(this);
                obj.text = opt.find("a").text();
                obj.val = opt.attr("value");
                obj.index = opt.index();
                obj.typeSpan.text(obj.text);
                if (obj.text === "支出") {
                    $("#type").val("EXPEND");
                } else {
                    $("#type").val("INCOME");
                }
            });
        }
    }

    $(document).ready(function () {
        new TypeDropDown($("#typeDropdown"));
        last();

        showDay();
    });

    function showDay() {

        $("#toastContent").text("123");
        const toastLiveExample = document.getElementById('liveToast')
        const toast = new bootstrap.Toast(toastLiveExample)
        toast.show()
    }

    function flow() {
        let type = document.getElementById("type").value;
        let amount = document.getElementById("amount").value;
        let remark = document.getElementById("remark").value;
        $.ajax({
            type: "post",
            dataType: "json",
            url: "/flow",
            contentType: "application/json",
            data: JSON.stringify({
                "user": "user",
                "type": type,
                "amount": amount,
                "remark": remark
            }),
            success: function (result) {
                console.log("result is :" + result)
                location.reload();
            }
        })
    }

    const Flow = {id: "", user: "", type: "", amount: "", remark: "", createTime: ""};

    function last() {
        $.ajax({
            type: "get",
            url: "/flow/last",
            contentType: "application/json",
            success: function (result) {
                $("#lastTime").val(result.data.createTime);
                $("#lastAmount").val(result.data.amount);
                $("#lastRemark").val(result.data.remark);
            }
        })
    }
</script>
</html>